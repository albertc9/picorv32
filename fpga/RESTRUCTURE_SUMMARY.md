# PicoRV32 FPGA 项目重新整理总结
====================================

## 重新整理概述

本次重新整理将原始的PicoRV32项目重新组织为一个专门为FPGA开发优化的结构，提高了项目的可维护性、可扩展性和易用性。

## 主要改进

### 1. 目录结构优化

**原始结构问题：**
- 文件散落在根目录
- 缺乏清晰的分类
- 不同FPGA平台的示例混合在一起

**新的结构：**
```
fpga/
├── rtl/                    # RTL设计文件
│   ├── core/              # CPU核心
│   ├── peripherals/       # 外设模块
│   └── memory/            # 内存模块
├── constraints/           # 约束文件
├── simulation/           # 仿真文件
├── examples/             # FPGA示例
│   ├── ice40/           # iCE40系列
│   ├── xilinx7/         # Xilinx 7系列
│   └── generic/         # 通用平台
├── scripts/             # 脚本文件
├── firmware/            # 固件代码
├── tests/              # 测试文件
└── dhrystone/          # 基准测试
```

### 2. 统一的构建系统

**新增功能：**
- 主Makefile：统一管理整个项目
- 平台特定Makefile：针对不同FPGA平台
- 依赖检查：自动检查工具链
- 清理功能：一键清理生成文件

**使用示例：**
```bash
cd fpga
make help          # 查看帮助
make check-deps    # 检查依赖
make test          # 运行测试
make firmware      # 构建固件
```

### 3. 多平台支持

**支持的FPGA平台：**
- **iCE40系列**：HX8K、iCEBreaker等
- **Xilinx 7系列**：Artix-7、Kintex-7、Virtex-7
- **通用平台**：可移植到其他FPGA

**新增内容：**
- Xilinx 7系列示例和约束文件
- 通用的SoC顶层模块
- 平台特定的综合脚本

### 4. 改进的文档

**新增文档：**
- 详细的README.md
- 快速开始指南
- 开发指南
- 故障排除指南

**文档特点：**
- 中文说明
- 结构清晰
- 包含代码示例
- 实用的使用指南

### 5. 模块化设计

**RTL模块化：**
- 核心CPU模块独立
- 外设模块可重用
- 内存控制器标准化
- 接口定义清晰

**配置灵活性：**
- 参数化设计
- 可配置的CPU特性
- 可扩展的外设接口
- 灵活的内存映射

## 技术特性

### CPU配置选项
- `ENABLE_COUNTERS`: 性能计数器
- `ENABLE_REGS_16_31`: 扩展寄存器
- `ENABLE_REGS_DUALPORT`: 双端口寄存器文件
- `COMPRESSED_ISA`: 压缩指令集
- `CATCH_MISALIGN`: 内存对齐检查
- `CATCH_ILLINSN`: 非法指令捕获

### 内存映射
```
0x00000000 - 0x00FFFFFF: 内部SRAM
0x01000000 - 0x01FFFFFF: 外部SPI Flash
0x02000000 - 0x02000003: SPI Flash控制器配置
0x02000004 - 0x02000007: UART时钟分频器
0x02000008 - 0x0200000B: UART发送/接收数据
0x03000000 - 0xFFFFFFFF: 用户外设
```

### 外设支持
- **UART**: 简单串口通信
- **SPI Flash**: 外部存储
- **LED**: 状态指示
- **按钮**: 用户输入
- **开关**: 配置选项

## 使用流程

### 1. 环境准备
```bash
# 检查工具链
make check-deps

# 安装缺失的工具
# 根据警告信息安装相应工具
```

### 2. 基本测试
```bash
# 运行仿真测试
make test

# 构建固件
make firmware
```

### 3. FPGA开发
```bash
# iCE40平台
cd examples/ice40
make hx8kprog

# Xilinx平台
cd examples/xilinx7
make all-steps
```

## 文件统计

**重新整理后的文件数量：**
- 总文件数：315个
- 新增文件：315个
- 代码行数：71,199行

**主要文件类型：**
- Verilog文件：RTL设计
- C文件：固件代码
- 脚本文件：构建和综合
- 约束文件：FPGA引脚定义
- 文档文件：说明和指南

## 兼容性

**向后兼容：**
- 保持原有API不变
- 支持现有的测试套件
- 兼容原有的固件代码
- 保持相同的功能特性

**扩展性：**
- 易于添加新的FPGA平台
- 支持新的外设模块
- 可扩展的构建系统
- 模块化的设计架构

## 总结

这次重新整理显著改善了PicoRV32项目的结构，使其更适合FPGA开发：

1. **更好的组织**：文件分类清晰，易于查找
2. **更强的可维护性**：模块化设计，便于修改
3. **更高的可扩展性**：支持多种FPGA平台
4. **更友好的用户体验**：统一的构建系统和完善的文档
5. **更强的专业性**：符合FPGA开发的最佳实践

这个重新整理的项目现在可以作为FPGA开发的标准模板，为后续的开发工作提供了坚实的基础。 